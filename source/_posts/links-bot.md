---
title: 友链机器人
date: 2025-09-05 22:25:00
updated: 2025-09-05 22:35:00
tags:
  - tgbot
  - workers
categories:
  - 后端
---

# 🌐 10分钟搭建 友链机器人

无需复杂编程，跟着步骤走，轻松实现 Hexo 博客**AnZhiYu 主题**友链的远程增删改查，再也不用手动改 YAML 文件！


## 📋 前置准备（3样关键信息）
先收集以下3个核心凭证，后续直接复制使用，避免中途卡顿：

| 名称 | 作用 | 获取方式 |
|------|------|----------------|
| **Telegram Bot Token** | 机器人的“身份证”，用于对接 Telegram 接口 | 1. 打开 Telegram，私聊 `@BotFather` <br> 2. 发送 `/newbot`，按提示给机器人起名字（如“我的博客友链助手”） <br> 3. 生成后复制 `token`（格式：`123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`） |
| **管理员 Chat ID** | 限制仅你能操作机器人，防止他人篡改友链 | 1. 私聊 `@userinfobot`（Telegram 内置机器人） <br> 2. 机器人会直接回复你的 `ID`（纯数字，如 `12345678`） |
| **GitHub Token** | 让机器人有权读写你博客仓库的友链文件 | 1. 登录 GitHub，进入 [Token 生成页](https://github.com/settings/tokens) <br> 2. 点击 `Generate new token`，勾选 **`repo`** 权限（展开后全选） <br> 3. 点击底部生成，复制 Token（仅显示一次，建议临时存记事本） |


## 🚀 第一步：部署 Cloudflare Worker（免费服务器）
Cloudflare Worker 是免费的轻量运行环境，用来承载机器人代码，零服务器成本：

### 1. 创建 Worker 应用
1. 打开 [Cloudflare 控制台](https://dash.cloudflare.com/)，登录后左侧菜单找到 **Workers & Pages** → 点击 **创建应用** → 选择 **创建 Worker**。
2. 给 Worker 起个名字（如 `blog-friendlink-bot`），点击 **部署**（先默认部署，后续改代码）。

### 2. 配置环境变量（安全存储敏感信息）
⚠️ 关键步骤！避免 Token 硬编码泄露，所有敏感信息加密存储：
1. 部署后，点击顶部 **设置** 标签页 → 找到 **环境变量** → 点击 **添加变量**。
2. 按表格依次添加3个变量，**每个都要勾选“加密”选项**：

| 变量名 | 变量值 | 说明 |
|--------|--------|------|
| `TGBOT_TOKEN` | 前面获取的 Telegram Bot Token | 机器人对接 Telegram 的凭证 |
| `ADMIN_CHAT_ID` | 你的管理员 Chat ID（纯数字） | 仅该 ID 能执行增删改操作 |
| `GITHUB_TOKEN` | 前面获取的 GitHub Token | 机器人操作博客仓库的权限凭证 |

3. 点击 **保存**，环境变量配置完成。

### 3. 粘贴机器人代码
1. 回到顶部 **代码** 标签页，删除默认的示例代码。
2. 复制下方的完整机器人代码，粘贴到代码编辑器中。
3. 关键修改：找到代码中 `CONFIG` 部分，更新2个信息：
   - `GITHUB_REPO`：你的博客仓库路径（如 `newstartsw/hexo-action`，格式：`用户名/仓库名`）
   - `GITHUB_BRANCH`：仓库主分支（一般是 `main`，老仓库可能是 `master`，按自己 GitHub 仓库实际分支改）
4. 点击 **保存并部署**，代码部署完成。


## 🔗 第二步：配置 Telegram Webhook（打通消息通道）
让 Telegram 能把你的命令转发给 Worker 机器人：
1. 复制你的 Worker 域名（代码页面顶部“部署”下方，如 `blog-friendlink-bot.yourname.workers.dev`）。
2. 在浏览器地址栏输入以下链接（替换 `[Worker域名]` 为你的实际域名）：
   ```
   https://[Worker域名]/?setwebhook
   ```
3. 访问后，页面显示 `{"ok":true,"result":true}` 表示配置成功（如果报错，检查 Worker 域名是否正确）。


## 🎯 第三步：测试机器人功能
打开 Telegram，找到你创建的机器人，发送命令测试，所有操作实时同步到 GitHub 友链文件：

### 1. 基础命令（必测）
| 命令 | 效果 | 示例 |
|------|------|------|
| `/help` | 查看所有支持的命令 | 发送后会返回完整命令列表 |
| `/友链 查询` | 查看当前所有友链（含分类、完整参数） | 正常会显示“框架”“推荐博客”等分类及下属友链 |

### 2. 核心功能（增删改）
#### （1）添加分类
```
/友链 添加分类 分类名称|样式|后缀|分类描述（可选）
```
示例：`/友链 添加分类 技术博客|flexcard|""|程序员博客合集`  
→ 成功后发送 `/友链 查询` 可看到新分类。

#### （2）添加友链
```
/友链 添加友链 分类序号|友链名称|友链URL|头像URL|描述|截图URL（可选）|颜色标签（可选）|技术标签（可选）|是否推荐（true/false，可选）
```
示例：`/友链 添加友链 1|安知鱼博客|https://blog.anheyu.com/|https://avatar.jpg|生活明朗，万物可爱|https://shot.jpg|vip|技术|true`  
→ 序号从1开始，分类序号可通过 `/友链 查询` 查看。

#### （3）修改友链
```
/友链 修改友链 分类序号|友链序号|新名称|新URL|新头像|新描述|新截图|新颜色|新标签|新推荐状态
```
示例：`/友链 修改友链 1|1|安知鱼新版|https://blog.anheyu.com/|https://new-avatar.jpg|生活明朗，万物可爱|https://new-shot.jpg|vip|技术|true`  
→ 不需要修改的参数也需保留位置（空值可填 `""`）。

#### （4）删除友链/分类
```
# 删除友链
/友链 删除友链 分类序号|友链序号

# 删除分类（会删除分类下所有友链）
/友链 删除分类 分类序号
```
示例：`/友链 删除友链 1|2`（删除第1分类第2条友链）


## 🚨 常见问题排查
1. **发送命令无响应？**
   - 检查 Webhook 配置：重新访问 `https://[Worker域名]/?setwebhook`，确保返回 `ok: true`。
   - 查看 Worker 日志：代码页面顶部 **日志** 标签页，查看是否有错误（如“GitHub Token 无效”）。

2. **“无法获取友链数据”？**
   - 检查 `GITHUB_REPO` 是否正确（用户名/仓库名不要写错）。
   - 确认 GitHub Token 有 `repo` 权限（重新生成 Token 时务必勾选）。

3. **增删改提示“失败”？**
   - 检查分类/友链序号是否正确（序号从1开始，不是0）。
   - 确认你发送命令的 Telegram 账号 ID 与 `ADMIN_CHAT_ID` 一致（非管理员无权限）。


## ✨ 最终效果
- 远程管理：手机上发送命令，即可实时更新博客友链，无需手动改 YAML 文件。
- 安全可控：仅管理员能操作，敏感信息加密存储，无泄露风险。
- 完整兼容：支持 `siteshot`（截图）、`color`（标签色）等所有友链参数。

按以上步骤操作，10分钟内即可搭建完成，后续维护友链再也不用打开仓库修改啦！
